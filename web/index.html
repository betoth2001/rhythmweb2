<html>
<head>
	<title>Rhythmbox REST/Ajax Web Control</title>
	<script type="text/javascript" src="jquery-1.4.4.js"></script>
	<script type="text/javascript" src="common.js"></script>
	<script type="text/javascript" src="player.js"></script>
	<LINK href="style.css" rel="stylesheet" type="text/css">
	
	<!-- 
	<script type="text/javascript" src="player.js"></script>
	-->
</head>
<body>
	<script type="text/javascript">

	function clear_tabs() {
		$('#tab_playlist').removeClass('selected');
		$('#tab_library').removeClass('selected');
		$('#tab_search').removeClass('selected');
	}

	function hide_all() {
		$('#playlist').addClass('hide');
		$('#library').addClass('hide');
		$('#search').addClass('hide');
	}
	
	$(document).ready(function() {
		$('#tab_playlist').click(function () {
			clear_tabs();
			hide_all();
			$(this).addClass('selected');
			load_playlist();
			$('#playlist').removeClass('hide');
		});
		
		$('#tab_library').click(function () {
			clear_tabs();
			hide_all();
			$(this).addClass('selected');
			$('#library').removeClass('hide');
		});
		
		$('#tab_search').click(function () {
			clear_tabs();
			hide_all();
			$(this).addClass('selected');
			$('#search').removeClass('hide');
		});

		setTimeout('load_library(0, 100)', 100);
	});

	function load_library(first, limit) {
		var url = 'rest/search/song/first/' + first + '/limit/' + limit;
		$('#library').html('');
		$.getJSON(url, function(json) {
			if (json && json.entries) {
				first = parseInt(first);
				limit = parseInt(limit);
				var count = json.entries.length;
				var prev = first - limit;
				var next = first + limit;

				if(first > 0) {
					$('#library').append('<span class="library_previous">' +
							'<img id="go_previous_top" src="img/go-previous.svg" class="link" />' + 
							'</span>');
					$('#go_previous_top').click( function() {
						load_library(prev, limit);
					});
				} else {
					$('#library').append('<span class="library_previous">' +
							'&nbsp;' +
							'</span>');
				}

				$('#library').append('<span class="library_status">showing ' + count + 
						' starting at ' + first + 
						'</span>');
				
				if (count == limit) {
					$('#library').append('<span class="library_next">' + 
							'<img id="go_next_top" src="img/go-next.svg" class="link" />' +
							'</span>');
					$('#go_next_top').click( function() {
						load_library(next, limit);
					});
				} else {
					$('#library').append('<span class="library_next">' +
							'&nbsp;' +
							'</span>');
				}

				$('#library').append(create_header());
				
				$.each(json.entries, function(index, entry) {
					add_search_entry(index, entry, '#library');
				});
				
				if(first > 0) {
					$('#library').append('<img id="go_previous" src="img/go-previous.svg" class="link">');
					$('#go_previous').click( function() {
						load_library(prev, limit);
					});
				}
				
				if (count == limit) {
					$('#library').append('<img id="go_next" src="img/go-next.svg" class="link">');
					$('#go_next').click( function() {
						load_library(next, limit);
					});
				}
			}
		});
	}
		
	</script>
	<div id="player">
		<span id="player_buttons">
			<img id="previous" class='link' src='img/previous.svg'/>
			<img id="seek_back" class='link' src='img/seek-backward.svg'/>
			<span id="play_pause" class='link'>
				<span id='play'><img src='img/play.svg'/></span>
				<span id='pause'><img src='img/pause.svg'/></span>
			</span>
			<img id="seek_forward" class='link' src='img/seek-forward.svg'/>
			<img id="next" class='link' src='img/next.svg'/>
		</span>
		<span id="title"></span>
		<span id="artist"></span>
		<span id="album"></span>
		<span id='time'></span>
	</div>
	<div id="tabs">
		<ul>
			<li>
				<span id="tab_playlist" class="selected">playlist</span>
			</li>
			<li>
				<span id="tab_library">library</span>
			</li>
			<li>
				<span id="tab_search">search</span>
			</li>
		</ul>
		<div id="content">
			<div id="playlist">
			</div>
			<div id="library" class="hide">
			</div>
			<div id="search" class="hide">
				this is the search
			</div>
		</div>
	</div>
</body>
</html>